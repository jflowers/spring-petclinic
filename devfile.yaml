apiVersion: 1.0.0
metadata:
  generateName: wksp-spring-pet-clinic
projects:
  - name: spring-petclinic
    source:
      location: >-
        http://gogs-appdev-opentlc.apps.cluster-tysons-d7da.tysons-d7da.example.opentlc.com/gogs/spring-petclinic
      type: git
      branch: master
components:
  - id: redhat/java8/latest
    type: chePlugin
  - id: redhat/dependency-analytics/latest
    type: chePlugin
  - mountSources: true
    endpoints:
      - name: 8080/tcp
        port: 8080
    memoryLimit: 2Gi
    type: dockerimage
    alias: gradle
    image: 'registry.redhat.io/codeready-workspaces/stacks-java-rhel8:2.0'
    volumes:
      - name: gradle
        containerPath: /home/jboss/.gradle
    env:
      - name: GRADLE_USER_HOME
        value: /home/jboss/.gradle
      - name: JAVA_OPTS
        value: "-XX:MaxRAMPercentage=50 -XX:+UseParallelGC -XX:MinHeapFreeRatio=10
          -XX:MaxHeapFreeRatio=20 -XX:GCTimeRatio=4 -XX:AdaptiveSizePolicyWeight=90
          -Dsun.zip.disableMemoryMapping=true -Xms20m -Djava.security.egd=file:/dev/./urandom"
      - name: JAVA_TOOL_OPTIONS
        value: $(JAVA_OPTS)
      - name: HOME
        value: /home/jboss
commands:
  -
    name: gradle build
    actions:
      -
        type: exec
        component: gradle
        command: "./gradlew build"
        workdir: ${CHE_PROJECTS_ROOT}/spring-petclinic
  -
    name: gradle run
    actions:
      -
        type: exec
        component: gradle
        command: "./gradlew bootRun"
        workdir: ${CHE_PROJECTS_ROOT}/spring-petclinic
